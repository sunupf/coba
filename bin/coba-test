#!/usr/bin/env node

(function(){
  var program = require('commander');
  var fs = require('fs-extra');
  var _ = require('lodash');
  var path = require('path');
  var errors = require('../lib/errors');
  var validate = require('../lib/validation');
  var spawn = require('child_process').spawn;
  var browserDriver,configFile;

  program
    .version('0.0.1')
    .arguments('<config> [browser]')
    .action(function(config,browser){
      configFile = config
      browserDriver = browser
    });

  program
    .on('--help', function() {
      require('../help/test')
    });

  program.parse(process.argv);
  if (typeof configFile === 'undefined') {
    console.error('No config file given!');
    require('../help/test')
  }else{
    var config;
    var scenario;
    try{
      console.log(configFile)
      config = require(process.cwd()+'/'+configFile);
    }catch(e){
      return console.log(e.message);
    }
    if(typeof browserDriver === 'undefined') {
      browserDriver = config.browser;
    }

    global.browserDriver = browserDriver;
    console.log(global.browserDriver)

    if(!_.size(config)){
      return console.log("There are errors on your config file, please check it");
    }

    scenario = config.scenario;
    var cobaTest;
    try{
      console.log(process.cwd()+"/"+scenario)

      // TODO require lib/test.js
      var Test = require('../lib/test')
      var objTest = new Test(config)
      objTest.start()

      objTest.showConfig();
      // throw config param

      require(process.cwd()+'/'+scenario)(objTest.driver , objTest.webdriver);

    }catch(e){
      return console.log(e.message);
    }
  }
}).call(this)
